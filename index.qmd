---
format: 
  revealjs:
    slide-number: true
    # preview-links: true
    code-link: true
    highlight-style: a11y
    chalkboard: true
    # self-contained: true
    # scrollable: true
    logo: images/logo.png
    theme: 
      - style.scss
---

<hr>

[Synthesis of calibration plots]{.custom-title}

<hr>

<br> <br>

[Mu√±oz, Debray & de Jong]{.custom-subtitle}

Julius Center for Health Sciences and Primary Care, Epidemiology Methods Team

------------------------------------------------------------------------

[{{< fa check >}} Motivation]{.slide-title} ![](images/F1.png)

------------------------------------------------------------------------

[{{< fa check >}} Calibration plots from clusters]{.slide-title}

```{r}
#| echo: false
library(ggplot2)
load("images/dataplot1.Rdata")
load("images/sdata1.Rdata")
```

```{r fig.width=12, fig.height=6}
ggplot(data = dataplot, aes(x = pi, y =pr,color=as.factor(cluster))) +
  theme_light()+
  geom_ribbon(aes(ymin = Lpr, ymax = Upr), fill = "lightgray",alpha = .3, colour = NA)+ 
  geom_abline(color="black",linetype="dashed")+
  geom_line(color="#047C90")+
  facet_wrap(~cluster,ncol=10)+
  labs( x =expression("Estimated probability"~(pi)),
        y = "Empirical probability")+
  theme(legend.position="none")+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
```

------------------------------------------------------------------------

[{{< fa check >}} Calibration plots from clusters]{.slide-title}

```{r fig.width=10, fig.height=6}
ggplot(data = dataplot) +
  theme_light()+
  geom_line(aes(x = pi, y = pr,group=cluster),color="#047C90",alpha=0.2)+
  labs( x =expression("Estimated probability"~(pi)),
        y = "Actual proportion")+
  theme(legend.position="none")+
  geom_line(data=sdata,aes(x,y),size=1.5,color="#003660")+
  geom_abline(color="black",linetype="dashed")+
   labs( x =expression("Estimated probability"~(pi)),
        y = "Empirical probability")+
  theme(legend.position="none")
```

------------------------------------------------------------------------

[{{< fa check >}} Calibration plots from clusters]{.slide-title}

```{r fig.width=10, fig.height=6}
ggplot(data = dataplot) +
  theme_light()+
    geom_line(aes(x = pi, y = pr,group=cluster),color="#047C90",alpha=0.2)+
  labs( x =expression("Estimated probability"~(pi)),
        y = "Actual proportion")+
  theme(legend.position="none")+
  geom_ribbon(data=sdata,aes(x=x,ymax=ymax,ymin=ymin), fill = "white")+
  geom_line(data=sdata,aes(x,y),size=1.5,color="#003660")+
  geom_abline(color="black",linetype="dashed")+
   labs( x =expression("Estimated probability"~(pi)),
        y = "Empirical probability")+
  theme(legend.position="none")
```

------------------------------------------------------------------------

[{{< fa check >}} Multiple Imputation]{.slide-title}

<hr>

**Aim:** Evaluate methods for synthesizing calibration curves from multiple imputed datasets in terms of confidence interval (CI) length, bias and coverage. We focus on:

::: incremental
-   Smoothed calibration curves.
-   Smooth functions : Loess, Locfit, natural splines.
-   Confidence intervals: Closed form, Bootstrap.
:::

------------------------------------------------------------------------

[{{< fa check >}} Data generation]{.slide-title} ![](images/d1.png)

------------------------------------------------------------------------

[{{< fa check >}} Data generation]{.slide-title} ![](images/d2.png) ------------------------------------------------------------------------

[{{< fa check >}} Data generation]{.slide-title} ![](images/d3.png)

------------------------------------------------------------------------

[{{< fa check >}} Data generation]{.slide-title} ![](images/d4.png)

------------------------------------------------------------------------

[{{< fa check >}} Data generation]{.slide-title} ![](images/d5.png) 

------------------------------------------------------------------------

[{{< fa check >}} Methods]{.slide-title}

<hr>

::: incremental
**1. Multiple imputation only (m):**

[{{< fa check >}} MI = 10.]{.custom-subtitle}

-   **m_stack:** Stack imputed datasets.

-   **m_RRPar:** Calibration model with pooled parameters.

-   **m_RR:** Pooled closed form SE with Rubin Rules.
:::

------------------------------------------------------------------------

[{{< fa check >}} Methods]{.slide-title}

<hr>

::: incremental
**2. MICE followed by bootstrap (mb):**

[{{< fa check >}} BS = 1000, MI = 10.]{.custom-subtitle}

-   **mb_Qp:** Bootstrap percentile pooled sample.

-   **mb_RR:** Pooled with Rubin's rules.
:::

------------------------------------------------------------------------

[{{< fa check >}} Methods]{.slide-title}

<hr>

::: incremental
**3. Bootstrap followed by MICE (bm):**

[{{< fa check >}} BS = 1000.]{.custom-subtitle}

-   **bm_Q:** Bootstrap percentile (M=10).

-   **bm_Qp:** Bootstrap percentile pooled sample (M=10).

-   **bm_VH:** von Hippel and Bartlett (M=2).

-   **bm_Q1:** Single imputation (M=1).
:::

------------------------------------------------------------------------

[{{< fa check >}} Conditional results]{.slide-title} ![](images/Cond.png)

------------------------------------------------------------------------

[{{< fa check >}} Marginal results: CI length]{.slide-title} ![](images/medCIL2.png)

------------------------------------------------------------------------

[{{< fa check >}} Marginal results: Bias]{.slide-title} ![](images/meanbias2.png)

------------------------------------------------------------------------

[{{< fa check >}} Best method : Mean absolute error]{.slide-title} ![](images/probici.png)

------------------------------------------------------------------------

[{{< fa check >}} Marginal results: Coverage]{.slide-title} ![](images/mediancov.png)

------------------------------------------------------------------------

[{{< fa check >}} Best method: Coverage]{.slide-title} ![](images/rank.png) Proportion of within 5% of nominal coverage. ![](images/rank.png)

------------------------------------------------------------------------

[{{< fa check >}} Conclusion]{.slide-title}

<hr>

::: incremental
-   From the simulation, we could not find an overall winning method in terms of coverage and bias, but methods using bootstrap followed by MICE in general produce calibration curves with more estimates within the confidence interval of the nominal coverage.

-   Considering processing time, a promising strategy could be Bootstrap with a single imputation method with a locfit smoother.
:::

------------------------------------------------------------------------

[{{< fa check >}} References]{.slide-title}

-   Austin PC, Steyerberg EW. Graphical assessment of internal and external calibration of logistic regression models by using loess smoothers. Stat Med. 2014; 33(3): 517-535.

-   Harrell FE Jr. Regression Modeling Strategies. 2nd ed. New York, NY: Springer-Verlag; 2015.

-   Bartlett, J. W., & Hughes, R. A. (2020). Bootstrap inference for multiple imputation under uncongeniality and misspecification. Statistical methods in medical research, 29(12), 3533-3546.

